<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EscapeRealm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css?v=2" />
</head>
<body>

  <div id="auth-wrapper">
    <div class="scanline"></div>
    
    <div class="container" id="container">
        
        <div class="form-container sign-up-container">
            <form id="signup-form">
                <h1 class="pixel-header text-blue-glow">CREATE ACCOUNT</h1>
                
                <div class="social-container">
                    <a href="#" class="social-btn google"><i class="fa-brands fa-google"></i></a>
                    <a href="#" class="social-btn facebook"><i class="fa-brands fa-facebook-f"></i></a>
                </div>
                
                <span>or use your email for registration</span>
                
                <div class="input-wrapper">
                    <input type="text" id="signup-username" placeholder="Username" required />
                </div>

                <div class="input-wrapper">
                    <input type="email" id="signup-email" placeholder="Email" />
                </div>

                <div class="input-wrapper password-box">
                    <input type="password" id="signup-password" placeholder="Password" required autocomplete="new-password" />
                    <i class="fa-solid fa-eye toggle-pass" data-target="signup-password"></i>
                </div>
                
                <button type="submit" class="action-btn">Register</button>
                <p id="signup-message" class="error-msg"></p>
            </form>
        </div>

        <div class="form-container sign-in-container">
            <form id="login-form">
                <h1 class="pixel-header text-blue-glow">PLAYER LOGIN</h1>
                
                <div class="social-container">
                    <a href="#" class="social-btn google"><i class="fa-brands fa-google"></i></a>
                    <a href="#" class="social-btn facebook"><i class="fa-brands fa-facebook-f"></i></a>
                </div>
                
                <span>or use your account</span>

                <div class="input-wrapper">
                    <input type="text" id="login-username" placeholder="Username" required />
                </div>

                <div class="input-wrapper password-box">
                    <input type="password" id="login-password" placeholder="Password" required autocomplete="current-password" />
                    <i class="fa-solid fa-eye toggle-pass" data-target="login-password"></i>
                </div>
                
                <a href="#" class="forgot-link">Forgot Password?</a>
                
                <button type="submit" class="action-btn">Login</button>
                <p id="login-message" class="error-msg"></p>
            </form>
        </div>

        <div class="toggle-container">
            <div class="toggle">
                <div class="toggle-panel toggle-right">
                    <h1 class="pixel-header">NEW<br>PLAYER?</h1>
                    <p>Enter your details to start your survival journey.</p>
                    <button type="button" class="ghost-btn" id="signUpBtn">Sign Up</button>
                </div>
                <div class="toggle-panel toggle-left">
                    <h1 class="pixel-header">WELCOME<br>BACK!</h1>
                    <p>To keep connected with the server, please login.</p>
                    <button type="button" class="ghost-btn" id="signInBtn">Sign In</button>
                </div>
            </div>
        </div>
    </div>
  </div>

  <div id="game-container" style="display: none;"></div>

<div id="ui-container" class="hidden">
    
    <div class="top-bar">
        <div class="hud-group left">
            <div class="hud-label">OPERATOR</div>
            <div class="hud-value" id="player-username">Loading...</div>
        </div>
        
        <div class="hud-title">ESCAPE REALM</div>

        <div class="hud-group right">
            <div class="hud-label">CREDITS</div>
            <div class="hud-value text-gold" id="player-coins">0 ðŸª™</div>
        </div>
        <input 
      id="chatInput" 
      type="text" 
      placeholder="Type AI command..." 
      style="
          position: absolute;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          width: 300px;
          padding: 10px;
          font-size: 18px;
          border-radius: 8px;
          border: 2px solid #3498db;
          outline: none;
          background: #ffffffcc;
          z-index: 9999;
          display: none;
      "
    >
    </div>

    <div id="main-menu" class="panel active">
        <div class="dashboard-container">
            
            <h2 class="section-title">SELECT GAME MODE</h2>
            <p class="section-subtitle">Choose how you want to play EscapeREALM</p>

            <div class="cards-wrapper">
                
                <div class="game-card">
                    <div class="card-icon">
                        <i class="fa-solid fa-user-astronaut"></i>
                    </div>
                    <h3>Single Player</h3>
                    <p class="card-desc">Challenge yourself against the game's toughest levels alone.</p>
                    
                    <ul class="card-features">
                        <li><i class="fa-solid fa-check"></i> 5 Challenging Levels</li>
                        <li><i class="fa-solid fa-check"></i> Unlock Progression</li>
                        <li><i class="fa-solid fa-check"></i> Earn Max Coins</li>
                    </ul>

                    <button class="mode-button btn-primary" data-mode="SINGLE PLAYER">
                        SELECT MODE
                    </button>
                </div>

                <div class="game-card">
                    <div class="card-icon">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                    <h3>AI Co-Op</h3>
                    <p class="card-desc">Team up with an advanced AI to solve puzzles together.</p>
                    
                    <ul class="card-features">
                        <li><i class="fa-solid fa-check"></i> Assistive AI</li>
                        <li><i class="fa-solid fa-check"></i> Double Trouble</li>
                        <li><i class="fa-solid fa-check"></i> Survival Mode</li>
                    </ul>

                    <button class="mode-button btn-secondary" data-mode="AI CO-OP">
                        SELECT MODE
                    </button>
                </div>

                <div class="game-card">
                    <div class="lock-overlay"><i class="fa-solid fa-lock"></i></div>
                    <div class="card-icon">
                        <i class="fa-solid fa-microchip"></i>
                    </div>
                    <h3>AI vs You</h3>
                    <p class="card-desc">Face off against an intelligent AI opponent in a race.</p>
                    
                    <ul class="card-features">
                        <li><i class="fa-solid fa-check"></i> Smart Adaptation</li>
                        <li><i class="fa-solid fa-check"></i> High Stakes</li>
                        <li><i class="fa-solid fa-check"></i> Leaderboards</li>
                    </ul>

                    <button class="mode-button" data-mode="PLAYER VS AI">
                        SELECT MODE
                    </button>
                </div>

            </div>
            
            <div class="bottom-nav">
                <button id="shop-btn" class="nav-icon-btn"><i class="fa-solid fa-cart-shopping"></i> SHOP</button>
                <button id="settings-btn" class="nav-icon-btn"><i class="fa-solid fa-gear"></i> SETTINGS</button>
                <button id="about-btn" class="nav-icon-btn"><i class="fa-solid fa-circle-info"></i> ABOUT</button>
                
                <button id="logout-btn" class="nav-icon-btn" style="border-color: #e74c3c; color: #e74c3c;">
                    <i class="fa-solid fa-power-off"></i> LOGOUT
                </button>
            </div>

        </div>
    </div>

    <div id="level-select-panel" class="panel">
        <div class="dashboard-container" style="max-width: 1200px;"> 
            
            <h1 class="section-title" style="font-size: 40px; margin-bottom: 5px;">SELECT LEVEL</h1>
            <p class="section-subtitle">All sectors unlocked. Difficulty increases by sector.</p>

            <div class="level-grid-modern">
                
                <div class="level-card">
                    <div class="card-top"><span class="lvl-tag">SECTOR 01</span></div>
                    <h2 class="lvl-title">Neon Gateway</h2>
                    <div class="lvl-stars" style="color: #2ecc71;"> 
                        <i class="fa-solid fa-star active" style="color: #2ecc71;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                    </div>
                    <p class="lvl-desc">Initiate your sequence. Bypass the outer firewalls.</p>
                    <div class="lvl-reward">
                        <i class="fa-solid fa-link text-gold"></i><span>Reward</span><span class="amount text-gold">50</span>
                    </div>
                    <button class="lvl-btn primary" data-level="1">START LEVEL</button>
                </div>

                <div class="level-card">
                    <div class="card-top"><span class="lvl-tag">SECTOR 02</span></div>
                    <h2 class="lvl-title">Cyber Caverns</h2>
                    <div class="lvl-stars">
                        <i class="fa-solid fa-star active" style="color: #2ecc71;"></i>
                        <i class="fa-solid fa-star active" style="color: #2ecc71;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                    </div>
                    <p class="lvl-desc">Ride the data stream. Avoid the corruption spikes.</p>
                    <div class="lvl-reward">
                        <i class="fa-solid fa-link text-gold"></i><span>Reward</span><span class="amount text-gold">100</span>
                    </div>
                    <button class="lvl-btn primary" data-level="2">START LEVEL</button>
                </div>

                <div class="level-card">
                    <div class="card-top"><span class="lvl-tag">SECTOR 03</span></div>
                    <h2 class="lvl-title">Glitch City</h2>
                    <div class="lvl-stars">
                        <i class="fa-solid fa-star active" style="color: #f1c40f;"></i>
                        <i class="fa-solid fa-star active" style="color: #f1c40f;"></i>
                        <i class="fa-solid fa-star active" style="color: #f1c40f;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                    </div>
                    <p class="lvl-desc">Unstable platforms detected. Watch your step.</p>
                    <div class="lvl-reward">
                        <i class="fa-solid fa-link text-gold"></i><span>Reward</span><span class="amount text-gold">150</span>
                    </div>
                    <button class="lvl-btn primary" data-level="3">START LEVEL</button>
                </div>

                <div class="level-card">
                    <div class="card-top"><span class="lvl-tag">SECTOR 04</span></div>
                    <h2 class="lvl-title">Void Walker</h2>
                    <div class="lvl-stars">
                        <i class="fa-solid fa-star active" style="color: #e67e22;"></i>
                        <i class="fa-solid fa-star active" style="color: #e67e22;"></i>
                        <i class="fa-solid fa-star active" style="color: #e67e22;"></i>
                        <i class="fa-solid fa-star active" style="color: #e67e22;"></i>
                        <i class="fa-solid fa-star" style="color: #444;"></i>
                    </div>
                    <p class="lvl-desc">Security drones are active. Do not be seen.</p>
                    <div class="lvl-reward">
                        <i class="fa-solid fa-link text-gold"></i><span>Reward</span><span class="amount text-gold">200</span>
                    </div>
                    <button class="lvl-btn primary" data-level="4">START LEVEL</button>
                </div>

                <div class="level-card">
                    <div class="card-top"><span class="lvl-tag">SECTOR 05</span></div>
                    <h2 class="lvl-title">System Core</h2>
                    <div class="lvl-stars">
                        <i class="fa-solid fa-star active" style="color: #e74c3c; text-shadow: 0 0 8px red;"></i>
                        <i class="fa-solid fa-star active" style="color: #e74c3c; text-shadow: 0 0 8px red;"></i>
                        <i class="fa-solid fa-star active" style="color: #e74c3c; text-shadow: 0 0 8px red;"></i>
                        <i class="fa-solid fa-star active" style="color: #e74c3c; text-shadow: 0 0 8px red;"></i>
                        <i class="fa-solid fa-star active" style="color: #e74c3c; text-shadow: 0 0 8px red;"></i>
                    </div>
                    <p class="lvl-desc">The final override. Survive the ultimate purge.</p>
                    <div class="lvl-reward">
                        <i class="fa-solid fa-link text-gold"></i><span>Reward</span><span class="amount text-gold">300</span>
                    </div>
                    <button class="lvl-btn primary" data-level="5">START LEVEL</button>
                </div>

            </div>
            
            <button class="back-button" style="position:relative; top:auto; right:auto; margin-top:30px;">BACK TO MENU</button>
        </div>
    </div>

    <div id="modal-overlay" class="hidden"></div>
    <div id="modal-container" class="hidden">
<div id="shop-panel" class="panel">
    <div class="panel-content glass-panel shop-panel">

        <h1 class="shop-title">SHOP</h1>
        <p class="shop-subtitle">Purchase skins from here.</p>

        <div class="shop-grid">
<!-- ITEM 1 -->
<div class="shop-item">
    <div class="shop-img" style="width:100%; height:120px; background:rgba(255,255,255,0.05); border-radius:8px; margin-bottom:10px;"></div>
    <h3 class="item-name">Quantum Booster</h3>
    <div class="item-footer">
        <span class="item-price">1000 ðŸª™</span>
        <button class="item-buy-btn">BUY</button>
    </div>
</div>

<!-- ITEM 2 -->
<div class="shop-item">
    <div class="shop-img" style="width:100%; height:120px; background:rgba(255,255,255,0.05); border-radius:8px; margin-bottom:10px;"></div>
    <h3 class="item-name">Cyber Shield</h3>
    <div class="item-footer">
        <span class="item-price">1500 ðŸª™</span>
        <button class="item-buy-btn">BUY</button>
    </div>
</div>

<!-- ITEM 3 -->
<div class="shop-item">
    <div class="shop-img" style="width:100%; height:120px; background:rgba(255,255,255,0.05); border-radius:8px; margin-bottom:10px;"></div>
    <h3 class="item-name">Neon Drive Core</h3>
    <div class="item-footer">
        <span class="item-price">2000 ðŸª™</span>
        <button class="item-buy-btn">BUY</button>
    </div>
</div>

<!-- ITEM 4 -->
<div class="shop-item">
    <div class="shop-img" style="width:100%; height:120px; background:rgba(255,255,255,0.05); border-radius:8px; margin-bottom:10px;"></div>
    <h3 class="item-name">AI Companion Upgrade</h3>
    <div class="item-footer">
        <span class="item-price">2500 ðŸª™</span>
        <button class="item-buy-btn">BUY</button>
    </div>
</div>
        <button class="back-button shop-back">BACK</button>
    </div>
</div>



        </div><div id="about-panel" class="panel">
    <div class="panel-content glass-panel">
        <button class="back-button">BACK</button>

        <h1>ABOUT US</h1>
        <p>EscapeRealm</p>

        <!-- Developer Cards -->
        <div class="dev-container">

            <div class="dev-card">
                <img src="/assets/dev/dev1.jpg" class="dev-img">
                <h2 class="dev-name">Anas</h2>
                <h3 class="dev-role">Gameplay & Systems Developer</h3>
                <p class="dev-desc">
                    Worked on the engine, backend features, gameplay mechanics, coin system,
                    and AI modes like Co-Op and AI Race. Helped turn ideas into working game systems.
                </p>
            </div>

            <div class="dev-card">
                <img src="/assets/dev/dev2.jpg" class="dev-img">
                <h2 class="dev-name">Husen</h2>
                <h3 class="dev-role">Creative & Frontend Developer</h3>
                <p class="dev-desc">
                    Created the game concept, mode ideas, level designs, UI/UX, textures,
                    animations, and visual style. Also contributed in bug fixes and polishing
                    the final player experience.
                </p>
            </div>

        </div> <!-- /dev-container -->

    </div> <!-- /panel-content -->
</div> <!-- /about-panel -->

<!-- Settings Panel (must be OUTSIDE About Panel) -->
<div id="settings-panel" class="panel">
    <div class="panel-content glass-panel">
        <button class="back-button">BACK</button>
        <h1>SETTINGS</h1>
        <p>Audio: ON <br> Graphics: ULTRA</p>
    </div>
</div>

<script type="module" src="game.js"></script>
<script>
    // --- GLOBAL VARIABLES ---
    let phaserGame = null;
    let selectedMode = "single_player";
    let playerCoins = 0; // <-- synced with backend + game

    // --- UTILS ---
    window.uiModeToFolder = function(modeLabel) {
        const l = (modeLabel || "").toLowerCase();
        if (l.includes("single")) return "single_player";
        if (l.includes("co-op") || l.includes("coop")) return "ai_coop";
        if (l.includes("player") && l.includes("ai")) return "ai_race";
        return "single_player";
    };

    document.addEventListener("DOMContentLoaded", () => {
        console.log("EscapeRealm UI Loaded");

        // UI Elements
        const authWrapper = document.getElementById('auth-wrapper');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        
        const uiContainer = document.getElementById("ui-container");
        const gameContainer = document.getElementById("game-container");
        const mainMenuPanel = document.getElementById("main-menu");
        const levelSelectPanel = document.getElementById("level-select-panel");
        const chatInput = document.getElementById("chatInput");

        const loginMessage = document.getElementById("login-message");
        const signupMessage = document.getElementById("signup-message");
        const userDisplay = document.getElementById("player-username");
        const coinDisplay = document.getElementById("player-coins");

        // -------------------------
        // 1. LOGIN LOGIC (BACKEND)
        // -------------------------
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value.trim();

                if (!username || !password) {
                    if (loginMessage) loginMessage.textContent = "Please enter username and password.";
                    return;
                }

                try {
                    const res = await fetch("http://localhost:5000/login", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ username, password }),
                    });

                    if (res.ok) {
                        const data = await res.json();
                        if (loginMessage) loginMessage.textContent = "";
                        handleLoginSuccess(data.username || username, data.coins ?? 0);
                    } else {
                        const err = await res.json().catch(() => ({}));
                        if (loginMessage) {
                            loginMessage.textContent = err.message || "Invalid username or password.";
                        }
                    }
                } catch (error) {
                    console.error("Login error:", error);
                    if (loginMessage) loginMessage.textContent = "Server not responding. Is backend running?";
                }
            });
        }
        
        // -------------------------
        // 2. SIGNUP LOGIC (BACKEND)
        // -------------------------
        if (signupForm) {
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('signup-username').value.trim();
                const password = document.getElementById('signup-password').value.trim();
                const email = document.getElementById('signup-email').value.trim();

                if (!username || !password) {
                    if (signupMessage) signupMessage.textContent = "Username and password are required.";
                    return;
                }

                try {
                    const res = await fetch("http://localhost:5000/signup", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ username, password, email }),
                    });

                    if (res.ok) {
                        const data = await res.json();
                        if (signupMessage) signupMessage.textContent = "Account created! Logging in...";
                        handleLoginSuccess(username, data.coins ?? 0);
                    } else {
                        const err = await res.json().catch(() => ({}));
                        if (signupMessage) {
                            signupMessage.textContent = err.message || "Signup failed.";
                        }
                    }
                } catch (error) {
                    console.error("Signup error:", error);
                    if (signupMessage) signupMessage.textContent = "Server not responding. Is backend running?";
                }
            });
        }

        // -------------------------
        // LOGIN SUCCESS HANDLER
        // -------------------------
        function handleLoginSuccess(username, coins) {
            window.playerName = username;
            playerCoins = coins || 0;

            if (authWrapper) authWrapper.style.display = 'none';
            if (uiContainer) uiContainer.classList.remove("hidden");
            
            if (userDisplay) userDisplay.textContent = username;
            if (coinDisplay) coinDisplay.textContent = `${playerCoins} ðŸª™`;

            if (gameContainer) gameContainer.style.display = 'none';
        }

        // -------------------------
        // 3. MODE SELECTION
        // -------------------------
        document.querySelectorAll(".mode-button").forEach(btn => {
            btn.addEventListener("click", () => {
                const mode = btn.getAttribute("data-mode");
                selectedMode = window.uiModeToFolder(mode);
                
                if (mainMenuPanel) mainMenuPanel.classList.remove("active");
                if (levelSelectPanel) levelSelectPanel.classList.add("active");

                if (chatInput) {
                    const l = (mode || "").toLowerCase();
                    chatInput.style.display = (l.includes("ai") || l.includes("co")) ? "block" : "none";
                }
            });
        });

        // -------------------------
        // 4. LEVEL SELECTION
        // -------------------------
        document.querySelectorAll(".lvl-btn").forEach(btn => {
            btn.addEventListener("click", (e) => {
                e.stopPropagation();
                const levelNum = btn.getAttribute("data-level");
                if (levelNum) startGameplaySafe(levelNum);
            });
        });

        function startGameplaySafe(levelNumber) {
            console.log(`Starting Level ${levelNumber} in ${selectedMode}...`);

            if (uiContainer) uiContainer.classList.add("hidden");
            if (gameContainer) gameContainer.style.display = "block";

            if (typeof window.initPhaserGame === "function") {
                // pass real coins from backend
                phaserGame = window.initPhaserGame(
                    window.playerName || "Guest",
                    playerCoins || 0
                );
            }

            setTimeout(() => {
                const sceneKey = getSceneKey(selectedMode);
                const scene = phaserGame && phaserGame.scene.getScene(sceneKey);
                
                if (scene) {
                    scene.scene.restart({ mode: selectedMode, level: Number(levelNumber) });
                }
            }, 50);
        }

        function getSceneKey(mode) {
            if (mode === "ai_coop") return "AICoopScene";
            if (mode === "ai_race") return "AIRaceScene";
            return "GameplayScene";
        }

        // -------------------------
        // 5. HOME BUTTON LOGIC
        // -------------------------
        window.showMainMenuUI = function () {
            if (phaserGame) {
                // grab latest coins from registry before destroying
                const regCoins = phaserGame.registry.get("coins");
                if (typeof regCoins === "number") {
                    playerCoins = regCoins;
                    if (coinDisplay) coinDisplay.textContent = `${playerCoins} ðŸª™`;
                }

                phaserGame.destroy(true);
                phaserGame = null;
            }
            
            if (gameContainer) gameContainer.style.display = "none";
            if (uiContainer) uiContainer.classList.remove("hidden");
            
            if (mainMenuPanel) mainMenuPanel.classList.add("active");
            if (levelSelectPanel) levelSelectPanel.classList.remove("active");
            if (chatInput) chatInput.style.display = "none";
        };

        // 6. BACK BUTTONS (level & modals)
        document.querySelectorAll(".back-button").forEach(btn => {
            btn.addEventListener("click", () => {
                const modalContainer = document.getElementById("modal-container");
                const modalOverlay = document.getElementById("modal-overlay");
                if (modalContainer) modalContainer.classList.add("hidden");
                if (modalOverlay) modalOverlay.classList.add("hidden");
                
                if (levelSelectPanel && levelSelectPanel.classList.contains("active")) {
                    levelSelectPanel.classList.remove("active");
                    if (mainMenuPanel) mainMenuPanel.classList.add("active");
                }
            });
        });

        // 7. TOGGLE SLIDE FOR AUTH
        const signUpBtn = document.getElementById('signUpBtn');
        const signInBtn = document.getElementById('signInBtn');
        const container = document.getElementById('container');

        if(signUpBtn && signInBtn && container){
            signUpBtn.addEventListener('click', () => container.classList.add("active"));
            signInBtn.addEventListener('click', () => container.classList.remove("active"));
        }
    });

    // --- MODAL LOGIC (Shop, Settings, About) ---
    const modalContainer = document.getElementById("modal-container");
    const modalOverlay = document.getElementById("modal-overlay");
    const shopPanel = document.getElementById("shop-panel");
    const settingsPanel = document.getElementById("settings-panel");
    const aboutPanel = document.getElementById("about-panel");

    function openModal(panel) {
        if (!panel) return;
        document.querySelectorAll("#modal-container .panel").forEach(p => p.classList.remove("active"));
        panel.classList.add("active");
        modalContainer.classList.remove("hidden");
        modalOverlay.classList.remove("hidden");
    }

    document.getElementById("shop-btn")?.addEventListener("click", () => openModal(shopPanel));
    document.getElementById("settings-btn")?.addEventListener("click", () => openModal(settingsPanel));
    document.getElementById("about-btn")?.addEventListener("click", () => openModal(aboutPanel));

    document.querySelectorAll(".back-button").forEach(btn => {
        btn.addEventListener("click", () => {
            modalContainer.classList.add("hidden");
            modalOverlay.classList.add("hidden");
        });
    });

    // --- LOGOUT LOGIC (optional: you can also POST /logout here) ---
    document.getElementById("logout-btn")?.addEventListener("click", () => {
        window.playerName = null;
        
        if (window._escapeGameInstance) {
            window._escapeGameInstance.destroy(true);
            window._escapeGameInstance = null;
        }

        document.getElementById("ui-container").classList.add("hidden");
        document.getElementById("game-container").style.display = "none";
        
        document.getElementById("auth-wrapper").style.display = "flex"; 
        
        document.getElementById("login-form").reset();

        document.getElementById("main-menu").classList.add("active");
        document.getElementById("level-select-panel").classList.remove("active");
        
        console.log("Logged out successfully");
    });

    // --- PASSWORD EYE TOGGLE ---
    document.querySelectorAll(".toggle-pass").forEach(icon => {
        icon.addEventListener("click", () => {
            const targetId = icon.getAttribute("data-target");
            const input = document.getElementById(targetId);
            
            if (!input) return;

            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
                icon.style.color = "#4aa2e9";
            } else {
                input.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
                icon.style.color = "#888";
            }
        });
    });
</script>
</body>
</html>